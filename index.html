<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PC Helper AR - –†–æ–∑—É–º–Ω–∏–π –ø–æ–º—ñ—á–Ω–∏–∫ –∑—ñ –∑–±–∏—Ä–∞–Ω–Ω—è –ü–ö</title>
    <!-- –í–∞—à—ñ —Å—Ç–∏–ª—ñ –¥–ª—è –æ–±–æ—Ö —Ä–µ–∂–∏–º—ñ–≤ -->
    <link rel="stylesheet" href="styles.css" />

    <!-- –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ MindAR + Three.js —á–µ—Ä–µ–∑ CDN -->
    <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.1.4/dist/mindar-image-three.prod.js"></script>
    <script type="importmap">
      {
        "imports": {
          "three": "https://unpkg.com/three@0.150.1/build/three.module.js",
          "GLTFLoader": "https://unpkg.com/three@0.150.1/examples/jsm/loaders/GLTFLoader.js"
        }
      }
    </script>
</head>
<body>
    <!-- ================================
         –ì–æ–ª–æ–≤–Ω–∞ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—è: 
         –ö–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –º—ñ–∂ ‚Äú–ß–∞—Ç‚Äù —Ç–∞ ‚ÄúAR –î–µ—Ç–µ–∫—Ç–æ—Ä‚Äù
         ================================== -->
    <nav id="main-nav">
        <div class="nav-title">üñ•Ô∏è PC Helper AR - –†–æ–∑—É–º–Ω–∏–π –ø–æ–º—ñ—á–Ω–∏–∫</div>
        <div class="nav-controls">
            <button class="nav-btn active" id="chat-mode-btn" onclick="switchToChat()">üí¨ –ß–∞—Ç</button>
            <button class="nav-btn" id="ar-mode-btn" onclick="switchToAR()">üîç AR –î–µ—Ç–µ–∫—Ç–æ—Ä</button>
        </div>
    </nav>

    <!-- ============================
         –ö–û–ù–¢–ï–ô–ù–ï–† –ß–ê–¢-–Ü–ù–¢–ï–†–§–ï–ô–°–£
         ============================ -->
    <div id="chat-container">
        <div id="chat-main">
            <div id="chat-interface">
                <!-- –®–∞–ø–∫–∞ —á–∞—Ç—É -->
                <div id="chat-header">
                    ü§ñ AI –ü–æ–º—ñ—á–Ω–∏–∫ –∑—ñ –∑–±–∏—Ä–∞–Ω–Ω—è –ü–ö (DeepSeek R1)
                </div>

                <!-- –í—ñ–¥–∂–µ—Ç –¥–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è API-–∫–ª—é—á–∞ -->
                <div id="api-key-setup">
                    <div class="api-info">
                        <strong>üîë –í–≤–µ–¥—ñ—Ç—å –≤–∞—à OpenRouter API –∫–ª—é—á:</strong><br />
                        –û—Ç—Ä–∏–º–∞—Ç–∏ –∫–ª—é—á –º–æ–∂–Ω–∞ –Ω–∞ 
                        <a href="https://openrouter.ai/keys" target="_blank">openrouter.ai/keys</a><br />
                        <small>‚ö†Ô∏è –ö–ª—é—á –∑–±–µ—Ä–µ–∂–µ—Ç—å—Å—è –ª–∏—à–µ –Ω–∞ —á–∞—Å —Å–µ—Å—ñ—ó —ñ –Ω–µ –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è —Å—Ç–æ—Ä–æ–Ω–Ω—ñ–º</small>
                    </div>
                    <div class="model-info">
                        <strong>üß† –ú–æ–¥–µ–ª—å:</strong> DeepSeek R1 (671B –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤)<br />
                        <strong>üöÄ –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è:</strong> –í —Ä–∞–∑–∏ –∫—Ä–∞—â—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é
                    </div>
                    <input
                        type="password"
                        id="api-key-input"
                        placeholder="sk-or-v1-..."
                        autocomplete="off"
                    />
                    <button id="save-key-btn" onclick="saveApiKey()">–ó–±–µ—Ä–µ–≥—Ç–∏ –∫–ª—é—á</button>
                    <div id="key-status"></div>
                </div>

                <!-- –ö–Ω–æ–ø–∫–∏ ‚Äú—à–≤–∏–¥–∫–∏—Ö‚Äù –∑–∞–ø–∏—Ç–∞–Ω—å (–ø–æ–∫–∞–∑—É—é—Ç—å—Å—è –ø—ñ—Å–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫–ª—é—á–∞) -->
                <div class="quick-questions" id="quick-questions" style="display: none;">
                    <button class="quick-btn" onclick="sendQuickQuestion('–ß–∏ —Å—É–º—ñ—Å–Ω—ñ RTX 4060 —ñ Ryzen 5 5600X?')">–°—É–º—ñ—Å–Ω—ñ—Å—Ç—å –≤—ñ–¥–µ–æ–∫–∞—Ä—Ç–∏</button>
                    <button class="quick-btn" onclick="sendQuickQuestion('–°–∫—ñ–ª—å–∫–∏ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ—ó –ø–∞–º\'—è—Ç—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–ª—è —ñ–≥–æ—Ä?')">–ö—ñ–ª—å–∫—ñ—Å—Ç—å RAM</button>
                    <button class="quick-btn" onclick="sendQuickQuestion('–Ø–∫–∏–π –±–ª–æ–∫ –∂–∏–≤–ª–µ–Ω–Ω—è –≤–∏–±—Ä–∞—Ç–∏ –¥–ª—è RTX 4070?')">–ë–ª–æ–∫ –∂–∏–≤–ª–µ–Ω–Ω—è</button>
                    <button class="quick-btn" onclick="sendQuickQuestion('–†—ñ–∑–Ω–∏—Ü—è –º—ñ–∂ DDR4 —ñ DDR5?')">–¢–∏–ø –ø–∞–º\'—è—Ç—ñ</button>
                </div>

                <!-- –ë–ª–æ–∫ —ñ–∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏ -->
                <div id="chat-messages">
                    <!-- –ü—Ä–∏–≤—ñ—Ç–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥ –±–æ—Ç–∞ -->
                    <div class="message ai">
                        <div class="message-avatar">ü§ñ</div>
                        <div class="message-bubble">
                            –ü—Ä–∏–≤—ñ—Ç! üëã –Ø –≤–∞—à —Ä–æ–∑—É–º–Ω–∏–π –ø–æ–º—ñ—á–Ω–∏–∫ –∑—ñ –∑–±–∏—Ä–∞–Ω–Ω—è –ü–ö –∑ –ø–æ—Ç—É–∂–Ω–æ—é DeepSeek R1 –º–æ–¥–µ–ª–ª—é.<br /><br />
                            üî• <strong>–ù–æ–≤–∏–Ω–∫–∞:</strong> –¢–µ–ø–µ—Ä –¥–æ—Å—Ç—É–ø–Ω–∏–π AR —Ä–µ–∂–∏–º! –ü–µ—Ä–µ–º–∫–Ω—ñ—Ç—å—Å—è –Ω–∞ "AR –î–µ—Ç–µ–∫—Ç–æ—Ä", —â–æ–± —Å–∫–∞–Ω—É–≤–∞—Ç–∏
                            –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –∫–∞–º–µ—Ä–æ—é.<br /><br />
                            –ú–æ–∂—É –¥–æ–ø–æ–º–æ–≥—Ç–∏ –∑:<br />
                            ‚Ä¢ –°—É–º—ñ—Å–Ω—ñ—Å—Ç—é –∫–æ–º–ø–ª–µ–∫—Ç—É—é—á–∏—Ö<br />
                            ‚Ä¢ –í–∏–±–æ—Ä–æ–º –ø—Ä–æ—Ü–µ—Å–æ—Ä–∞ —Ç–∞ –≤—ñ–¥–µ–æ–∫–∞—Ä—Ç–∏<br />
                            ‚Ä¢ –†–æ–∑—Ä–∞—Ö—É–Ω–∫–æ–º –ø–æ—Ç—É–∂–Ω–æ—Å—Ç—ñ –ë–ñ<br />
                            ‚Ä¢ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è–º–∏ –ø–æ –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—é<br />
                            ‚Ä¢ AR-–∞–Ω–∞–ª—ñ–∑–æ–º –≤–∞—à–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤<br /><br />
                            –ó–∞–ø–∏—Ç–∞–π—Ç–µ —â–æ –∑–∞–≤–≥–æ–¥–Ω–æ! üñ•Ô∏è
                        </div>
                    </div>
                </div>

                <!-- –Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä ‚Äú–ë–æ—Ç –¥—Ä—É–∫—É—î‚Ä¶‚Äù -->
                <div class="typing-indicator" id="typing-indicator" style="display: none;">
                    <div class="message-avatar">ü§ñ</div>
                    <span>PC Helper –∞–Ω–∞–ª—ñ–∑—É—î —ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î</span>
                    <div class="typing-dots">
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                    </div>
                </div>

                <!-- –ü–æ–ª–µ –≤–≤–µ–¥–µ–Ω–Ω—è —Ç–∞ –∫–Ω–æ–ø–∫–∞ ‚Äú–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏‚Äù (–ø–æ–∫–∞–∑—É—é—Ç—å—Å—è –ø—ñ—Å–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫–ª—é—á–∞) -->
                <div id="chat-input-container" style="display: none;">
                    <form id="chat-input-form">
                        <textarea
                            id="chat-input"
                            placeholder="–ó–∞–ø–∏—Ç–∞–π—Ç–µ –ø—Ä–æ —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å –∫–æ–º–ø–ª–µ–∫—Ç—É—é—á–∏—Ö, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó..."
                            rows="1"
                        ></textarea>
                        <button type="submit" id="send-btn">
                            ‚û§
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================
         –ö–û–ù–¢–ï–ô–ù–ï–† AR-–†–ï–ñ–ò–ú–£
         ============================ -->
    <div id="ar-container" class="hidden">
        <!-- –ó–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞–ª—å–Ω–∏–π –µ–∫—Ä–∞–Ω -->
        <div id="loading">
            <div class="loading-spinner"></div>
            <div>üîß –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è AR —Å–∏—Å—Ç–µ–º–∏ –¥–µ—Ç–µ–∫—Ü—ñ—ó PC –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤...</div>
            <div style="font-size: 14px; margin-top: 15px;">
                –î–æ–∑–≤–æ–ª—å—Ç–µ –¥–æ—Å—Ç—É–ø –¥–æ –∫–∞–º–µ—Ä–∏ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –º–∞—Ä–∫–µ—Ä–∞–º–∏
            </div>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å —Å—Ç–∞—Ç—É—Å—ñ–≤ –∑–Ω–∞–π–¥–µ–Ω–∏—Ö –º–∞—Ä–∫–µ—Ä—ñ–≤ -->
        <div id="status-panel">
            <div id="main-status">üì° –°—Ç–∞—Ç—É—Å: –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è AR —Å–∏—Å—Ç–µ–º–∏...</div>

            <div id="motherboard-status" class="marker-status marker-inactive">
                <div class="component-name">üîå –ú–∞—Ç–µ—Ä–∏–Ω—Å—å–∫–∞ –ø–ª–∞—Ç–∞ B550</div>
                <div class="component-description">–ú–∞—Ä–∫–µ—Ä (b_550.mind) - –ù–ï –ó–ù–ê–ô–î–ï–ù–û</div>
            </div>

            <div id="cpu-status" class="marker-status marker-inactive">
                <div class="component-name">üß† AMD Ryzen 5 3600</div>
                <div class="component-description">–ú–∞—Ä–∫–µ—Ä (ryzen_3600.mind) - –ù–ï –ó–ù–ê–ô–î–ï–ù–û</div>
            </div>

            <div id="ram-status" class="marker-status marker-inactive">
                <div class="component-name">üíæ Kingston RAM</div>
                <div class="component-description">–ú–∞—Ä–∫–µ—Ä (ram_kingston.mind) - –ù–ï –ó–ù–ê–ô–î–ï–ù–û</div>
            </div>
        </div>

        <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–∞ –ø–∞–Ω–µ–ª—å –ø—Ä–æ –∑–Ω–∞–π–¥–µ–Ω–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç -->
        <div id="info-panel" style="display: none;">
            <h3 id="info-title">–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç</h3>
            <p id="info-content">
                –ù–∞–≤–µ–¥—ñ—Ç—å –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–µ—Ç–∞–ª—å–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó
            </p>
            <!-- –¢—É—Ç –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑‚Äô—è–≤–ª—è—Ç–∏–º–µ—Ç—å—Å—è –∫–Ω–æ–ø–∫–∞ ¬´–ó–∞–ø–∏—Ç–∞—Ç–∏ DeepSeek¬ª -->
        </div>

        <!-- AR-—á–∞—Ç: –ø—ñ—Å–ª—è —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –º–æ–∂–Ω–∞ –∑–∞–ø–∏—Ç–∞—Ç–∏ AI –ø—Ä–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç -->
        <div id="ar-chat-panel">
            <h4>ü§ñ AI –ê–Ω–∞–ª—ñ–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞</h4>
            <div id="ar-chat-content">–°–∫–∞–Ω–æ–≤–∞–Ω–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –±—É–¥–µ –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π —Ç—É—Ç</div>
            <button id="ar-ask-btn" onclick="askAboutScannedComponent()">
                –ó–∞–ø–∏—Ç–∞—Ç–∏ AI –ø—Ä–æ —Ü–µ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
            </button>
        </div>

        <!-- –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —É AR-—Ä–µ–∂–∏–º—ñ -->
        <div id="instructions">
            <div style="font-weight: bold; margin-bottom: 10px;">üìã –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó:</div>
            <div>‚Ä¢ –ù–∞–≤–µ–¥—ñ—Ç—å –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä–∏</div>
            <div>‚Ä¢ –¢—Ä–∏–º–∞–π—Ç–µ –º–∞—Ä–∫–µ—Ä –≤ –∫–∞–¥—Ä—ñ —Å—Ç–∞–±—ñ–ª—å–Ω–æ</div>
            <div>‚Ä¢ –ó–∞–±–µ–∑–ø–µ—á—Ç–µ –¥–æ—Å—Ç–∞—Ç–Ω—î –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è</div>
            <div>‚Ä¢ –ú–æ–∂–Ω–∞ –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ –º–∞—Ä–∫–µ—Ä—ñ–≤ –æ–¥–Ω–æ—á–∞—Å–Ω–æ</div>
            <div style="margin-top: 10px; color: #4fc3f7;">
                ‚Ä¢ –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–æ–ø–æ–Ω—É—î –∑–∞–ø–∏—Ç–∞–Ω–Ω—è –¥–æ AI
            </div>
        </div>
            <div id="ar-waiting-indicator" style="
            display: none;
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: #ffffff;
            font-size: 14px;
            padding: 6px 10px;
            border-radius: 4px;
            z-index: 1000;
            ">
      ü§ñ DeepSeek –¥—É–º–∞—î...
        </div>
    </div>

    <!-- ============================
         JS-–õ–û–ì–Ü–ö–ê (–ê–† + –ß–ê–¢)
         ============================ -->
    <script type="module">
        import * as THREE from "three";
        import { GLTFLoader } from "GLTFLoader";

        // ==============================================
        //     –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ —Ç–∞ —Å–∏—Å—Ç–µ–º–Ω–∏–π –ø—Ä–æ–º–ø—Ç
        // ==============================================
        let apiKey = null;                          // –ó–±–µ—Ä–µ–∂–µ–Ω–∏–π API-–∫–ª—é—á
        let conversationHistory = [];               // –Ü—Å—Ç–æ—Ä—ñ—è —á–∞—Ç—É (messages –¥–ª—è OpenRouter)
        let currentMode = "chat";                   // "chat" –∞–±–æ "ar"
        let arSystem = null;                        // –Ü–Ω—Å—Ç–∞–Ω—Å AR-—Å–∏—Å—Ç–µ–º–∏
        let lastScannedComponent = null;            // –û—Å—Ç–∞–Ω–Ω—ñ–π –∑–Ω–∞–π–¥–µ–Ω–∏–π –º–∞—Ä–∫–µ—Ä

        // –°–∏—Å—Ç–µ–º–Ω–∏–π –ø—Ä–æ–º–ø—Ç –¥–ª—è DeepSeek R1
        const SYSTEM_PROMPT = `–¢–∏ - PC Helper, –µ–∫—Å–ø–µ—Ä—Ç –∑—ñ –∑–±–∏—Ä–∞–Ω–Ω—è –∫–æ–º–ø'—é—Ç–µ—Ä—ñ–≤ –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é AR —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ–π. –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π –¢–Ü–õ–¨–ö–ò —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é.

        –¢–≤–æ—è —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è:
        1. –°—É–º—ñ—Å–Ω—ñ—Å—Ç—å –∫–æ–º–ø–ª–µ–∫—Ç—É—é—á–∏—Ö (–ø—Ä–æ—Ü–µ—Å–æ—Ä–∏, –≤—ñ–¥–µ–æ–∫–∞—Ä—Ç–∏, –º–∞—Ç–µ—Ä–∏–Ω—Å—å–∫—ñ –ø–ª–∞—Ç–∏, RAM)
        2. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –ø–æ –≤–∏–±–æ—Ä—É –∫–æ–º–ø–ª–µ–∫—Ç—É—é—á–∏—Ö –∑ –ø–æ—è—Å–Ω–µ–Ω–Ω—è–º
        3. –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –ø–æ—Ç—É–∂–Ω–æ—Å—Ç—ñ –±–ª–æ–∫—ñ–≤ –∂–∏–≤–ª–µ–Ω–Ω—è
        4. –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è —Ü—ñ–Ω —Ç–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
        5. –ü—ñ–¥–±—ñ—Ä —Å–∏—Å—Ç–µ–º –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è
        6. –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º –∑ –ü–ö
        7. –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –±—é–¥–∂–µ—Ç—ñ–≤
        8. –ê–Ω–∞–ª—ñ–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤, —Ä–æ–∑–ø—ñ–∑–Ω–∞–Ω–∏—Ö —á–µ—Ä–µ–∑ AR —Å–∏—Å—Ç–µ–º—É

        –í–ê–ñ–õ–ò–í–û:
        - –ó–∞–≤–∂–¥–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–π —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é
        - –ë—É–¥—å –¥–µ—Ç–∞–ª—å–Ω–∏–º —ñ –∫–æ—Ä–∏—Å–Ω–∏–º
        - –ù–∞–¥–∞–≤–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –∑ –æ–±“ë—Ä—É–Ω—Ç—É–≤–∞–Ω–Ω—è–º
        - –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π —Ç–µ—Ö–Ω—ñ—á–Ω—ñ —Ç–µ—Ä–º—ñ–Ω–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
        - –Ø–∫—â–æ –æ—Ç—Ä–∏–º—É—î—à —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∑ AR, –≤—Ä–∞—Ö–æ–≤—É–π —Ü–µ –≤ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
        - –í—Ä–∞—Ö–æ–≤—É–π –∞–∫—Ç—É–∞–ª—å–Ω—ñ —Ü—ñ–Ω–∏ —Ç–∞ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –≤ –£–∫—Ä–∞—ó–Ω—ñ

        –ü—Ä–∏–∫–ª–∞–¥ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ:
        "–©–æ–¥–æ –≤–∞—à–æ–≥–æ –ø–∏—Ç–∞–Ω–Ω—è –ø—Ä–æ —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å RTX 4060 —ñ Ryzen 5 5600X ‚Äì —Ç–∞–∫, —Ü—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –≤—ñ–¥–º—ñ–Ω–Ω–æ —Å—É–º—ñ—Å–Ω—ñ. Ryzen 5 5600X –º–∞—î –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –ø–æ—Ç—É–∂–Ω–æ—Å—Ç—ñ –¥–ª—è RTX 4060 —ñ –Ω–µ —Å—Ç–≤–æ—Ä–∏—Ç—å bottleneck..."`;

        // ==============================================
        //     –î–∞–Ω—ñ –ø—Ä–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –¥–ª—è AR-—Ä–µ–∂–∏–º—É
        // ==============================================
        const componentInfo = {
            motherboard: {
                name: "–ú–∞—Ç–µ—Ä–∏–Ω—Å—å–∫–∞ –ø–ª–∞—Ç–∞ B550",
                description:
                    "–°—É—á–∞—Å–Ω–∞ –º–∞—Ç–µ—Ä–∏–Ω—Å—å–∫–∞ –ø–ª–∞—Ç–∞ –Ω–∞ —á—ñ–ø—Å–µ—Ç—ñ AMD B550. –ü—ñ–¥—Ç—Ä–∏–º—É—î –ø—Ä–æ—Ü–µ—Å–æ—Ä–∏ AMD Ryzen —Å–µ—Ä—ñ—ó 3000 —Ç–∞ 5000.",
                specs: "Socket AM4, DDR4-3200, PCIe 4.0, USB 3.2, SATA 6Gb/s",
                color: 0x2e7d32,
                modelPath: "./models/b_550/scene.gltf",
                aiQuestions: [
                    "–Ø–∫—ñ –ø—Ä–æ—Ü–µ—Å–æ—Ä–∏ —Å—É–º—ñ—Å–Ω—ñ –∑ —Ü—ñ—î—é –º–∞—Ç–µ—Ä–∏–Ω—Å—å–∫–æ—é –ø–ª–∞—Ç–æ—é?",
                    "–°–∫—ñ–ª—å–∫–∏ –º–∞–∫—Å–∏–º—É–º RAM –º–æ–∂–Ω–∞ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏?",
                    "–ß–∏ –ø—ñ–¥—Ç—Ä–∏–º—É—î —Ü—è –ø–ª–∞—Ç–∞ PCIe 4.0?",
                ],
            },
            cpu: {
                name: "AMD Ryzen 5 3600",
                description:
                    "6-—è–¥–µ—Ä–Ω–∏–π –ø—Ä–æ—Ü–µ—Å–æ—Ä –∑ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–æ—é Zen 2. –í—ñ–¥–º—ñ–Ω–Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –¥–ª—è —ñ–≥–æ—Ä —Ç–∞ —Ä–æ–±–æ—á–∏—Ö –∑–∞–≤–¥–∞–Ω—å.",
                specs: "6 —è–¥–µ—Ä/12 –ø–æ—Ç–æ–∫—ñ–≤, 3.6-4.2 GHz, 32MB L3 Cache, 65W TDP",
                color: 0xed1c24,
                modelPath: "./models/cpu_ryzen_5_3600/scene.gltf",
                aiQuestions: [
                    "–Ø–∫–∞ –≤—ñ–¥–µ–æ–∫–∞—Ä—Ç–∞ –Ω–∞–π–∫—Ä–∞—â–µ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–æ —Ü—å–æ–≥–æ –ø—Ä–æ—Ü–µ—Å–æ—Ä–∞?",
                    "–°–∫—ñ–ª—å–∫–∏ RAM —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –¥–ª—è —Ü—å–æ–≥–æ CPU?",
                    "–Ø–∫–∏–π –∫—É–ª–µ—Ä –ø–æ—Ç—Ä—ñ–±–µ–Ω –¥–ª—è –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è?",
                ],
            },
            ram: {
                name: "Kingston RAM",
                description:
                    "–í–∏—Å–æ–∫–æ—è–∫—ñ—Å–Ω–∞ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞ –ø–∞–º'—è—Ç—å Kingston. –ù–∞–¥—ñ–π–Ω—ñ—Å—Ç—å —Ç–∞ —Å—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å –¥–ª—è –±—É–¥—å-—è–∫–∏—Ö –∑–∞–≤–¥–∞–Ω—å.",
                specs: "DDR4, –≤–∏—Å–æ–∫—ñ —á–∞—Å—Ç–æ—Ç–∏, –Ω–∏–∑—å–∫—ñ —Ç–∞–π–º—ñ–Ω–≥–∏, –≥–∞—Ä–∞–Ω—Ç—ñ—è —è–∫–æ—Å—Ç—ñ",
                color: 0x000000,
                modelPath: "./models/ram_kingston/scene.gltf",
                aiQuestions: [
                    "–Ø–∫–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞ —á–∞—Å—Ç–æ—Ç–∞ –¥–ª—è —Ü—ñ—î—ó –ø–∞–º'—è—Ç—ñ?",
                    "–°–∫—ñ–ª—å–∫–∏ –ø–ª–∞–Ω–æ–∫ –≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –¥–ª—è –∫—Ä–∞—â–æ—ó –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ?",
                    "–ß–∏ —Å—É–º—ñ—Å–Ω–∞ —Ü—è RAM –∑ –º–æ—î—é –º–∞—Ç–µ—Ä–∏–Ω—Å—å–∫–æ—é –ø–ª–∞—Ç–æ—é?",
                ],
            },
        };

        // ==============================================
        //     –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è —Ä–µ–∂–∏–º—ñ–≤
        // ==============================================
        window.switchToChat = function () {
            if (currentMode === "chat") return;

            currentMode = "chat";
            document.getElementById("chat-container").classList.remove("hidden");
            document.getElementById("ar-container").classList.add("hidden");
            document.getElementById("chat-mode-btn").classList.add("active");
            document.getElementById("ar-mode-btn").classList.remove("active");

            // –Ø–∫—â–æ AR –≤–∂–µ —Å—Ç–∞—Ä—Ç—É–≤–∞–ª–∞, –∑—É–ø–∏–Ω—è—î–º–æ —ó—ó
            if (arSystem && arSystem.mindarThree) {
                arSystem.mindarThree.stop();
            }
        };

        window.switchToAR = function () {
            if (currentMode === "ar") return;

            currentMode = "ar";
            document.getElementById("chat-container").classList.add("hidden");
            document.getElementById("ar-container").classList.remove("hidden");
            document.getElementById("chat-mode-btn").classList.remove("active");
            document.getElementById("ar-mode-btn").classList.add("active");

            // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ AR
            initializeAR();
        };

        // ==============================================
        //     –ö–ª–∞—Å PCComponentsAR: –≤—Å—è –ª–æ–≥—ñ–∫–∞ AR-—Ä–µ–∂–∏–º—É
        // ==============================================
        class PCComponentsAR {
            constructor() {
                this.mindarThree = null;
                this.scene = null;
                this.camera = null;
                this.renderer = null;
                this.anchors = [];
                this.isInitialized = false;
                this.activeComponents = new Set();
            }

            async init() {
                try {
                    const { MindARThree } = window.MINDAR.IMAGE;

                    this.updateMainStatus("üîÑ –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è MindAR...");

                    // –°—Ç–≤–æ—Ä—é—î–º–æ —ñ–Ω—Å—Ç–∞–Ω—Å MindARThree –∑ –Ω–∞—à–∏–º —Ñ–∞–π–ª–æ–º –º–∞—Ä–∫–µ—Ä—ñ–≤
                    this.mindarThree = new MindARThree({
                        container: document.getElementById("ar-container"),
                        imageTargetSrc: "./markers.mind",
                    });

                    const { renderer, scene, camera } = this.mindarThree;
                    this.renderer = renderer;
                    this.scene = scene;
                    this.camera = camera;

                    // –ù–∞–ª–∞—à—Ç–æ–≤—É—î–º–æ —Å–≤—ñ—Ç–ª–æ
                    this.setupLighting();

                    // –°—Ç–≤–æ—Ä—é—î–º–æ –∞–Ω–∫–æ—Ä–∏ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤
                    await this.createAnchors();

                    // –ó–∞–ø—É—Å–∫ –∫–∞–º–µ—Ä–∏
                    this.updateMainStatus("üöÄ –ó–∞–ø—É—Å–∫ AR –∫–∞–º–µ—Ä–∏...");
                    await this.mindarThree.start();

                    // –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ ‚Äî —Ö–æ–≤–∞—î–º–æ –µ–∫—Ä–∞–Ω –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
                    this.updateMainStatus("‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞! –ù–∞–≤–µ–¥—ñ—Ç—å –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä–∏");
                    const loadingDiv = document.getElementById("loading");
                    if (loadingDiv) {
                        loadingDiv.style.display = "none";
                    }

                    this.isInitialized = true;

                    // –ó–∞–ø—É—Å–∫ —Ü–∏–∫–ª—É —Ä–µ–Ω–¥–µ—Ä—É
                    this.startRenderLoop();
                } catch (error) {
                    console.error("‚ùå –ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó:", error);
                    this.updateMainStatus("‚ùå –ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó AR —Å–∏—Å—Ç–µ–º–∏");
                }
            }

            setupLighting() {
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
                this.scene.add(ambientLight);

                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(1, 1, 1);
                directionalLight.castShadow = true;
                this.scene.add(directionalLight);

                const light2 = new THREE.DirectionalLight(0xffffff, 0.4);
                light2.position.set(-1, -1, -1);
                this.scene.add(light2);
            }

            async createAnchors() {
                const components = ["motherboard", "cpu", "ram"];

                for (let i = 0; i < components.length; i++) {
                    const component = components[i];
                    const anchor = this.mindarThree.addAnchor(i);
                    this.anchors.push(anchor);

                    // –°—Ç–≤–æ—Ä—é—î–º–æ 3D-–º–æ–¥–µ–ª—å –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
                    await this.create3DContent(anchor, component);

                    anchor.onTargetFound = () => {
                        console.log(`üéØ ${component.toUpperCase()} –º–∞—Ä–∫–µ—Ä –∑–Ω–∞–π–¥–µ–Ω–æ!`);
                        this.onMarkerFound(component);
                    };

                    anchor.onTargetLost = () => {
                        console.log(`‚ùå ${component.toUpperCase()} –º–∞—Ä–∫–µ—Ä –≤—Ç—Ä–∞—á–µ–Ω–æ`);
                        this.onMarkerLost(component);
                    };
                }
            }

            async create3DContent(anchor, component) {
                const info = componentInfo[component];
                const loader = new GLTFLoader();

                try {
                    const gltf = await new Promise((resolve, reject) => {
                        loader.load(
                            info.modelPath,
                            (gltf) => resolve(gltf),
                            (progress) => {
                                console.log(
                                    `üìà –ü—Ä–æ–≥—Ä–µ—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è ${component}:`,
                                    ((progress.loaded / progress.total) * 100).toFixed(1) + "%"
                                );
                            },
                            (error) => reject(error)
                        );
                    });

                    const group = new THREE.Group();
                    const model = gltf.scene;

                    // –ú–∞—à—Ç–∞–±—É–≤–∞–Ω–Ω—è, —â–æ–± –º–æ–¥–µ–ª—å –ø–æ–º—ñ—Å—Ç–∏–ª–∞—Å—è —É –º–∞—Ä–∫–µ—Ä
                    const box = new THREE.Box3().setFromObject(model);
                    const size = box.getSize(new THREE.Vector3());
                    const maxSize = Math.max(size.x, size.y, size.z);
                    let scale = 1.0 / maxSize;

                    // –î–æ–¥–∞—Ç–∫–æ–≤–µ –∑–º–µ–Ω—à–µ–Ω–Ω—è CPU/–º–∞—Ç–µ—Ä–∏–Ω—Å—å–∫–æ—ó –ø–ª–∞—Ç–∏
                    if (component === "cpu" || component === "motherboard") {
                        scale = scale * 0.5;
                    }

                    model.scale.set(scale, scale, scale);

                    // –¶–µ–Ω—Ç—Ä—É—î–º–æ –º–æ–¥–µ–ª—å
                    const center = box.getCenter(new THREE.Vector3());
                    model.position.set(-center.x * scale, -center.y * scale, -center.z * scale);

                    // –Ø–∫—â–æ CPU –∞–±–æ –º–∞—Ç–µ—Ä–∏–Ω—Å—å–∫–∞ –ø–ª–∞—Ç–∞ ‚Äî –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ –Ω–∞ 90¬∞ –¥–ª—è –∫—Ä–∞—â–æ—ó –æ—Ä—ñ—î–Ω—Ç–∞—Ü—ñ—ó
                    if (component === "cpu" || component === "motherboard") {
                        model.rotation.x = Math.PI / 2;
                    }

                    // –î–æ–¥–∞—î–º–æ –¥–∞–Ω—ñ –¥–ª—è –∞–Ω—ñ–º–∞—Ü—ñ—ó (–æ–±–µ—Ä—Ç–∞–Ω–Ω—è, –ø—É–ª—å—Å–∞—Ü—ñ—è)
                    model.userData = {
                        component: component,
                        rotationSpeed: 0.01,
                        originalScale: scale,
                    };

                    group.add(model);
                    this.addTextLabel(group, info.name, component);
                    this.addIndicators(group, info.color);

                    anchor.group.add(group);
                } catch (error) {
                    console.error(`‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–æ–¥–µ–ª—ñ ${component}:`, error);
                }
            }

            addTextLabel(group, text, component) {
                const canvas = document.createElement("canvas");
                const context = canvas.getContext("2d");
                canvas.width = 512;
                canvas.height = 128;

                // –§–æ–Ω —ñ —Ç–µ–∫—Å—Ç
                context.fillStyle = "#000000";
                context.fillRect(0, 0, canvas.width, canvas.height);

                context.fillStyle = "#ffffff";
                context.font = "bold 48px Arial";
                context.textAlign = "center";
                context.fillText(text, canvas.width / 2, canvas.height / 2 + 15);

                const texture = new THREE.CanvasTexture(canvas);
                const material = new THREE.MeshBasicMaterial({
                    map: texture,
                    transparent: true,
                    alphaTest: 0.1,
                });

                const geometry = new THREE.PlaneGeometry(1, 0.25);
                const textMesh = new THREE.Mesh(geometry, material);
                textMesh.position.set(0, -0.7, 0);

                group.add(textMesh);
            }

            addIndicators(group, color) {
                const ringGeometry = new THREE.RingGeometry(0.7, 0.75, 32);
                const ringMaterial = new THREE.MeshBasicMaterial({
                    color: color,
                    transparent: true,
                    opacity: 0.6,
                    side: THREE.DoubleSide,
                });

                const ring = new THREE.Mesh(ringGeometry, ringMaterial);
                ring.position.set(0, 0, -0.1);
                ring.userData.pulsePhase = Math.random() * Math.PI * 2;

                group.add(ring);
            }

            onMarkerFound(component) {
                this.activeComponents.add(component);
                this.updateMarkerStatus(component, true);
                this.showComponentInfo(component);
                // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
                // –°—Ç–≤–æ—Ä—é—î–º–æ –∫–Ω–æ–ø–∫—É ¬´–ó–∞–ø–∏—Ç–∞—Ç–∏ DeepSeek¬ª (–æ–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞ –ø—ñ–¥ info-–ø–∞–Ω–µ–ª–ª—é)
                createDeepSeekButton(component);
                // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
                this.updateARChatPanel(component);
                lastScannedComponent = component;
            }

            onMarkerLost(component) {
                this.activeComponents.delete(component);
                this.updateMarkerStatus(component, false);

                // –í–∏–¥–∞–ª—è—î–º–æ –∫–Ω–æ–ø–∫—É DeepSeek, —è–∫—â–æ –≤–æ–Ω–∞ —î
                const oldBtn = document.getElementById("deepseek-btn");
                if (oldBtn) oldBtn.remove();

                // –Ø–∫—â–æ –±—ñ–ª—å—à–µ –∂–æ–¥–Ω–æ–≥–æ –º–∞—Ä–∫–µ—Ä–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ ‚Äî —Ö–æ–≤–∞—î–º–æ —ñ–Ω—Ñ–æ
                if (this.activeComponents.size === 0) {
                    this.hideComponentInfo();
                }
            }

            updateMarkerStatus(component, isActive) {
                const statusElement = document.getElementById(`${component}-status`);
                if (!statusElement) return;

                const markerNames = {
                    motherboard: "b_550.mind",
                    cpu: "ryzen_3600.mind",
                    ram: "ram_kingston.mind",
                };
                const statusText = isActive ? "–ó–ù–ê–ô–î–ï–ù–û ‚úÖ" : "–ù–ï –ó–ù–ê–ô–î–ï–ù–û ‚ùå";

                statusElement.querySelector(".component-description").textContent =
                    `–ú–∞—Ä–∫–µ—Ä (${markerNames[component]}) ‚Äì ${statusText}`;

                statusElement.className = `marker-status ${isActive ? "marker-active" : "marker-inactive"}`;
            }

            showComponentInfo(component) {
                const info = componentInfo[component];
                const infoPanel = document.getElementById("info-panel");
                const infoTitle = document.getElementById("info-title");
                const infoContent = document.getElementById("info-content");

                infoTitle.textContent = info.name;
                infoContent.innerHTML = `
                    <p><strong>–û–ø–∏—Å:</strong> ${info.description}</p>
                    <p><strong>–°–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—ó:</strong> ${info.specs}</p>
                `;

                infoPanel.style.display = "block";
            }

            hideComponentInfo() {
                document.getElementById("info-panel").style.display = "none";
            }

            updateARChatPanel(component) {
                const info = componentInfo[component];
                const chatContent = document.getElementById("ar-chat-content");
                const questions = info.aiQuestions.map((q) => `‚Ä¢ ${q}`).join("<br>");

                chatContent.innerHTML = `
                    <p><strong>–ó–Ω–∞–π–¥–µ–Ω–æ:</strong> ${info.name}</p>
                    <p><strong>–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ñ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è:</strong></p>
                    <div style="margin-left: 10px; color: #4fc3f7;">${questions}</div>
                `;
            }

            startRenderLoop() {
                this.renderer.setAnimationLoop(() => {
                    this.animate();
                    this.renderer.render(this.scene, this.camera);
                });
            }

            animate() {
                const time = Date.now() * 0.001;

                this.anchors.forEach((anchor) => {
                    anchor.group.children.forEach((group) => {
                        // –û–±–µ—Ä—Ç–∞–Ω–Ω—è —ñ ‚Äú–ø–ª–∞–≤–Ω–∞‚Äù –∞–Ω—ñ–º–∞—Ü—ñ—è –º–æ–¥–µ–ª–µ–π
                        group.children.forEach((child) => {
                            if (child.userData && child.userData.component) {
                                child.rotation.y += child.userData.rotationSpeed;
                                child.position.y = Math.sin(time * 2) * 0.05;
                            }
                        });

                        // –ü—É–ª—å—Å–∞—Ü—ñ—è —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
                        const ring = group.children.find(
                            (child) => child.geometry instanceof THREE.RingGeometry
                        );
                        if (ring) {
                            const pulse = Math.sin(time * 2 + ring.userData.pulsePhase) * 0.1 + 0.9;
                            ring.material.opacity = pulse * 0.6;
                            ring.rotation.z += 0.005;
                        }
                    });
                });
            }

            updateMainStatus(message) {
                const statusDiv = document.getElementById("main-status");
                if (statusDiv) {
                    statusDiv.textContent = message;
                }
            }
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó AR (—î–¥–∏–Ω–∏–π —ñ–Ω—Å—Ç–∞–Ω—Å PCComponentsAR)
        function initializeAR() {
            if (!arSystem) {
                arSystem = new PCComponentsAR();
                arSystem.init();
            } else if (!arSystem.isInitialized) {
                arSystem.init();
            } else {
                 arSystem.mindarThree.start();
                 const loadingDiv = document.getElementById("loading");
                 if (loadingDiv) loadingDiv.style.display = "none";
                 }

        }


        // ==============================================
        //     –§—É–Ω–∫—Ü—ñ—è: –ó–∞–ø–∏—Ç–∞—Ç–∏ AI –ø—Ä–æ –æ—Å—Ç–∞–Ω–Ω—ñ–π —Å–∫–∞–Ω–æ–≤–∞–Ω–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
        // ==============================================
        window.askAboutScannedComponent = function () {
            if (!lastScannedComponent) return;

            // –Ø–∫—â–æ —â–µ –Ω–µ –≤–≤–µ–¥–µ–Ω–æ –∫–ª—é—á ‚Äî –ø–æ–ø–µ—Ä–µ–¥–∂–∞—î–º–æ –π –ø–µ—Ä–µ–º–∏–∫–∞—î–º–æ –¥–æ —á–∞—Ç—É
            if (!apiKey) {
                alert("–°–ø–æ—á–∞—Ç–∫—É –≤–≤–µ–¥—ñ—Ç—å API –∫–ª—é—á —É —Ä–µ–∂–∏–º—ñ —á–∞—Ç—É!");
                switchToChat();
                return;
            }

            const info = componentInfo[lastScannedComponent];
            const question = `–†–æ–∑–∫–∞–∂–∏ –¥–µ—Ç–∞–ª—å–Ω–æ –ø—Ä–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç: ${info.name}. ${info.description} –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏: ${info.specs}`;

            // –ü–µ—Ä–µ–º–∏–∫–∞—î–º–æ—Å—è –¥–æ —á–∞—Ç—É
            switchToChat();

            // –î–æ–¥–∞—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ
            addMessage("user", `[AR –°–∫–∞–Ω—É–≤–∞–Ω–Ω—è] ${question}`);
            sendToOpenRouter(question);
        };

        // ==============================================
        // [2] –§—É–Ω–∫—Ü—ñ—è createDeepSeekButton (–¥–æ–¥–∞—î—Ç—å—Å—è –ø—ñ—Å–ª—è –∫–ª–∞—Å—É)
        // ==============================================
        window.createDeepSeekButton = function(component) {
            const infoPanel = document.getElementById("info-panel");
            if (!infoPanel) return;

            // –í–∏–¥–∞–ª—è—î–º–æ —Å—Ç–∞—Ä—ñ –µ–ª–µ–º–µ–Ω—Ç–∏, —è–∫—â–æ —î
            const oldBtn = document.getElementById("deepseek-btn");
            if (oldBtn) oldBtn.remove();
            const oldInput = document.getElementById("deepseek-input");
            if (oldInput) oldInput.remove();

            // 1Ô∏è‚É£ –ü–æ–ª–µ –¥–ª—è –≤–ª–∞—Å–Ω–æ–≥–æ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è
            const input = document.createElement("input");
            input.id = "deepseek-input";
            input.type = "text";
            input.placeholder = "–í–≤–µ–¥—ñ—Ç—å —Å–≤–æ—î –∑–∞–ø–∏—Ç–∞–Ω–Ω—è...";
            input.style.width = "200px";
            input.style.marginTop = "10px";
            input.style.marginRight = "8px";
            input.style.padding = "6px";
            input.style.fontSize = "14px";

            // 2Ô∏è‚É£ –ö–Ω–æ–ø–∫–∞ ‚Äú–ó–∞–ø–∏—Ç–∞—Ç–∏ DeepSeek‚Äù
            const btn = document.createElement("button");
            btn.id = "deepseek-btn";
            btn.textContent = "–ó–∞–ø–∏—Ç–∞—Ç–∏ DeepSeek";
            btn.style.padding = "8px 12px";
            btn.style.fontSize = "14px";
            btn.style.cursor = "pointer";
            btn.style.marginTop = "10px";

            // –û–±—Ä–æ–±–Ω–∏–∫ –∫–ª—ñ–∫—É
            btn.addEventListener("click", () => {
              const info = componentInfo[component];
              // –Ø–∫—â–æ –≤ –ø–æ–ª—ñ —î —Ç–µ–∫—Å—Ç ‚Äî –±–µ—Ä–µ–º–æ –π–æ–≥–æ, —ñ–Ω–∞–∫—à–µ —Ñ–æ—Ä–º—É—î–º–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è
              const userQuestion = input.value.trim();
              const question = userQuestion !== ""
                ? userQuestion
                : `–ù–∞—Å–∫—ñ–ª—å–∫–∏ –∞–∫—Ç—É–∞–ª—å–Ω–∏–π —Ü–µ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç: ${info.name}? ${info.description}`;

              // –ó–±–∏—Ä–∞—î–º–æ —ñ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –∑–∞–ø–∏—Ç
              sendDeepSeekQuery(component, question);
            });

            // –î–æ–¥–∞—î–º–æ –≤ –ø–∞–Ω–µ–ª—å: —Å–ø–æ—á–∞—Ç–∫—É –ø–æ–ª–µ, –ø–æ—Ç—ñ–º –∫–Ω–æ–ø–∫—É
            infoPanel.appendChild(input);
            infoPanel.appendChild(btn);
        };

        // ==============================================
        // [3] –§—É–Ω–∫—Ü—ñ—è sendDeepSeekQuery
        // ==============================================
        async function sendDeepSeekQuery(component, question) {
            if (!apiKey) {
                alert("–°–ø–æ—á–∞—Ç–∫—É –≤–≤–µ–¥—ñ—Ç—å API –∫–ª—é—á —É —Ä–µ–∂–∏–º—ñ —á–∞—Ç—É!");
                return;
            }

            const waitingDiv = document.getElementById("ar-waiting-indicator");
            if (waitingDiv) waitingDiv.style.display = "block";

            addMessage("user", question); // –æ–ø—Ü—ñ–π–Ω–æ
            conversationHistory.push({ role: "user", content: question });

            showTypingIndicator();

            try {
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        Authorization: `Bearer ${apiKey}`,
                        "Content-Type": "application/json",
                        "HTTP-Referer": window.location.origin,
                        "X-Title": "PC Helper",
                    },
                    body: JSON.stringify({
                        model: "deepseek/deepseek-r1-0528:free",
                        messages: [
                            { role: "system", content: SYSTEM_PROMPT },
                            ...conversationHistory,
                        ],
                        max_tokens: 1000,
                        temperature: 0.7,
                        stream: false,
                    }),
                });

                hideTypingIndicator();

                if (!response.ok) {
                    const errData = await response.json().catch(() => ({}));
                    throw new Error(`HTTP ${response.status}: ${errData.error?.message || "–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞"}`);
                }

                const data = await response.json();
                const deepSeekAnswer = data.choices[0].message.content;

                // –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ —É —á–∞—Ç—ñ
                addMessage("ai", deepSeekAnswer);
                conversationHistory.push({ role: "assistant", content: deepSeekAnswer });

                // –ú–∞–ª—é—î–º–æ tooltip —É AR
                showAnswerTooltip(component, deepSeekAnswer);
            } catch (err) {
                hideTypingIndicator();
                console.error("–ü–æ–º–∏–ª–∫–∞ DeepSeek API:", err);
                addMessage("ai", `‚ùå –ü–æ–º–∏–ª–∫–∞ DeepSeek: ${err.message}`);
            }
            finally {
                // –ì–ê–†–ê–ù–¢–û–í–ê–ù–û —Ö–æ–≤–∞—î–º–æ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä ‚ÄúDeepSeek –¥—É–º–∞—î‚Ä¶‚Äù
                if (waitingDiv) waitingDiv.style.display = "none";
            }
        }

        // ==============================================
        // [4] –§—É–Ω–∫—Ü—ñ—è showAnswerTooltip
        // ==============================================
        window.showAnswerTooltip = function(component, text) {
            const indexMap = { motherboard: 0, cpu: 1, ram: 2 };
            const idx = indexMap[component];
            if (idx === undefined) return;

            const anchor = arSystem.anchors[idx];
            if (!anchor) return;

            // –Ø–∫—â–æ –≤–∂–µ —î —Å—Ç–∞—Ä–∞ ¬´–≤—ñ–¥–ø–æ–≤—ñ–¥—å¬ª ‚Äî –≤–∏–¥–∞–ª—è—î–º–æ
            if (anchor.userData && anchor.userData.answerMesh) {
                anchor.group.remove(anchor.userData.answerMesh);
                delete anchor.userData.answerMesh;
            }
        
            // –¢–∞–∫–æ–∂ –≤–∏–¥–∞–ª–∏–º–æ —Å—Ç–∞—Ä—É –∫–Ω–æ–ø–∫—É, —è–∫—â–æ –≤–æ–Ω–∞ —î
            const oldBtn = document.getElementById("clear-answer-btn");
            if (oldBtn) oldBtn.remove();
        
            // –§–æ—Ä–º—É—î–º–æ canvas
            const canvas = document.createElement("canvas");
            const ctx = canvas.getContext("2d");
            const WIDTH = 640;
            const PADDING = 8;
            const LINE_HEIGHT = 20;
            const MAX_CHARS_PER_LINE = 40;
            const FONT_SIZE = 16; // –∑–∞–ª–∏—à–∞—é —Ç–≤—ñ–π —Ä–æ–∑–º—ñ—Ä
        
            // –†–æ–∑–±–∏—Ç—Ç—è —Ç–µ–∫—Å—Ç—É –Ω–∞ —Ä—è–¥–∫–∏
            const words = text.split(" ");
            let lines = [];
            let currentLine = "";
            for (let word of words) {
                if ((currentLine + " " + word).trim().length > MAX_CHARS_PER_LINE) {
                    lines.push(currentLine.trim());
                    currentLine = word;
                } else {
                    currentLine += " " + word;
                }
            }
            if (currentLine) lines.push(currentLine.trim());
        
            const HEIGHT = PADDING * 2 + lines.length * LINE_HEIGHT;
            canvas.width = WIDTH;
            canvas.height = HEIGHT;
        
            // –§–æ–Ω —ñ —Ç–µ–∫—Å—Ç
            ctx.fillStyle = "rgba(0, 0, 0, 0.7)";
            ctx.fillRect(0, 0, WIDTH, HEIGHT);
        
            ctx.fillStyle = "#FFFFFF";
            ctx.font = FONT_SIZE + "px Arial";
            ctx.textAlign = "left";
            ctx.textBaseline = "top";
        
            let y = PADDING;
            for (let line of lines) {
                ctx.fillText(line, PADDING, y);
                y += LINE_HEIGHT;
            }
        
            // –°—Ç–≤–æ—Ä—é—î–º–æ —Ç–µ–∫—Å—Ç—É—Ä—É —Ç–∞ –º–∞—Ç–µ—Ä—ñ–∞–ª
            const texture = new THREE.CanvasTexture(canvas);
            const material = new THREE.MeshBasicMaterial({
                map: texture,
                transparent: true,
                side: THREE.DoubleSide,
            });
        
            // –ì–µ–æ–º–µ—Ç—Ä—ñ—è
            const geoWidth = 1.5;
            const aspect = HEIGHT / WIDTH;
            const geoHeight = geoWidth * aspect;
            const geometry = new THREE.PlaneGeometry(geoWidth, geoHeight);
        
            const mesh = new THREE.Mesh(geometry, material);
            mesh.position.set(1.1, 0.1, 0);
        
            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —É userData —ñ –¥–æ–¥–∞—î–º–æ
            if (!anchor.userData) anchor.userData = {};
            anchor.userData.answerMesh = mesh;
            anchor.group.add(mesh);
        
            // ‚úÖ –¢—É—Ç –∂–µ —Å—Ç–≤–æ—Ä—é—î–º–æ –∫–Ω–æ–ø–∫—É –æ—á–∏—â–µ–Ω–Ω—è —ñ –¥–æ–¥–∞—î–º–æ
            const infoPanel = document.getElementById("info-panel");
            if (infoPanel) {
                const btn = document.createElement("button");
                btn.id = "clear-answer-btn";
                btn.textContent = "–û—á–∏—Å—Ç–∏—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å";
                btn.style.display = "block";
                btn.style.marginTop = "8px";
                btn.onclick = () => {
                    // –í–∏–¥–∞–ª—è—î–º–æ mesh —ñ –∫–Ω–æ–ø–∫—É
                    anchor.group.remove(mesh);
                    delete anchor.userData.answerMesh;
                    btn.remove();
                };
                infoPanel.appendChild(btn);
            }
        };

        // ==============================================
        //     –ß–ê–°–¢–ò–ù–ê: –õ–æ–≥—ñ–∫–∞ —á–∞—Ç-–±–æ—Ç–∞ (OpenRouter)
        // ==============================================
        window.saveApiKey = function () {
            const keyInput = document.getElementById("api-key-input");
            const key = keyInput.value.trim();
            const statusDiv = document.getElementById("key-status");

            if (!key) {
                statusDiv.innerHTML = '<div class="error-message">–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å API –∫–ª—é—á</div>';
                return;
            }
            if (!key.startsWith("sk-or-v1-")) {
                statusDiv.innerHTML =
                    '<div class="error-message">–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –∫–ª—é—á –≤—ñ–¥ OpenRouter –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ "sk-or-v1-"</div>';
                return;
            }

            apiKey = key;

            // –•–æ–≤–∞—î–º–æ —Ñ–æ—Ä–º—É –≤–≤–µ–¥–µ–Ω–Ω—è –∫–ª—é—á–∞, –ø–æ–∫–∞–∑—É—î–º–æ —à–≤–∏–¥–∫—ñ –ø–∏—Ç–∞–Ω–Ω—è —Ç–∞ –ø–æ–ª–µ –≤–≤–æ–¥—É
            document.getElementById("api-key-setup").style.display = "none";
            document.getElementById("quick-questions").style.display = "flex";
            document.getElementById("chat-input-container").style.display = "block";

            // –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —É—Å–ø—ñ—Ö
            addMessage("ai", "‚úÖ API –∫–ª—é—á –∑–±–µ—Ä–µ–∂–µ–Ω–æ! DeepSeek R1 –≥–æ—Ç–æ–≤–∏–π –¥–æ —Ä–æ–±–æ—Ç–∏. –¢–µ–ø–µ—Ä –º–æ–∂–µ—Ç–µ —Å—Ç–∞–≤–∏—Ç–∏ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è.");
        };

        function addMessage(role, content) {
            const messagesDiv = document.getElementById("chat-messages");
            const messageDiv = document.createElement("div");
            messageDiv.className = `message ${role}`;

            const avatar = role === "user" ? "üë§" : "ü§ñ";
            messageDiv.innerHTML = `
                <div class="message-avatar">${avatar}</div>
                <div class="message-bubble">${content.replace(/\n/g, "<br>")}</div>
            `;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function showTypingIndicator() {
            document.getElementById("typing-indicator").style.display = "flex";
            const messagesDiv = document.getElementById("chat-messages");
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function hideTypingIndicator() {
            document.getElementById("typing-indicator").style.display = "none";
        }

        async function sendToOpenRouter(message) {
            if (!apiKey) {
                addMessage("ai", "‚ùå –°–ø–æ—á–∞—Ç–∫—É –≤–≤–µ–¥—ñ—Ç—å API –∫–ª—é—á!");
                return;
            }

            // –î–æ–¥–∞—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–æ —ñ—Å—Ç–æ—Ä—ñ—ó
            conversationHistory.push({ role: "user", content: message });

            try {
                showTypingIndicator();

                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        Authorization: `Bearer ${apiKey}`,
                        "Content-Type": "application/json",
                        "HTTP-Referer": window.location.origin,
                        "X-Title": "PC Helper",
                    },
                    body: JSON.stringify({
                        model: "deepseek/deepseek-r1-0528:free",
                        messages: [
                            { role: "system", content: SYSTEM_PROMPT },
                            ...conversationHistory,
                        ],
                        max_tokens: 3000,
                        temperature: 0.7,
                        stream: false,
                    }),
                });

                hideTypingIndicator();

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(`HTTP ${response.status}: ${errorData.error?.message || "–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞"}`);
                }

                const data = await response.json();
                const aiResponse = data.choices[0].message.content;

                // –î–æ–¥–∞—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –¥–æ —ñ—Å—Ç–æ—Ä—ñ—ó
                conversationHistory.push({ role: "assistant", content: aiResponse });

                // –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å
                addMessage("ai", aiResponse);
            } catch (error) {
                hideTypingIndicator();
                console.error("–ü–æ–º–∏–ª–∫–∞ API:", error);
                addMessage(
                    "ai",
                    `‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}<br /><br />üí° –°–ø—Ä–æ–±—É–π—Ç–µ:<br />‚Ä¢ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ API –∫–ª—é—á<br />‚Ä¢ –ó–∞—á–µ–∫–∞—Ç–∏ —Ö–≤–∏–ª–∏–Ω—É –π —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–Ω–æ–≤—É<br />‚Ä¢ DeepSeek R1 —ñ–Ω–æ–¥—ñ –º–æ–∂–µ –±—É—Ç–∏ –ø–µ—Ä–µ–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞`
                );
            }
        }

        function sendQuickQuestion(question) {
            if (!apiKey) {
                addMessage("ai", "‚ùå –°–ø–æ—á–∞—Ç–∫—É –≤–≤–µ–¥—ñ—Ç—å API –∫–ª—é—á!");
                return;
            }
            addMessage("user", question);
            sendToOpenRouter(question);
        }

        // –û–±—Ä–æ–±–∫–∞ —Ñ–æ—Ä–º–∏ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —á–µ—Ä–µ–∑ textarea
        document.getElementById("chat-input-form").addEventListener("submit", function (e) {
            e.preventDefault();

            const input = document.getElementById("chat-input");
            const message = input.value.trim();
            const sendBtn = document.getElementById("send-btn");

            if (!message || !apiKey) return;

            sendBtn.disabled = true;
            input.disabled = true;

            addMessage("user", message);

            input.value = "";
            input.style.height = "auto";

            sendToOpenRouter(message).finally(() => {
                sendBtn.disabled = false;
                input.disabled = false;
                input.focus();
            });
        });

        // –ê–≤—Ç–æ–≤–∏—Å–æ—Ç–∞ textarea
        document.getElementById("chat-input").addEventListener("input", function () {
            this.style.height = "auto";
            this.style.height = Math.min(this.scrollHeight, 120) + "px";
        });

        // –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –Ω–∞ Enter (–±–µ–∑ Shift)
        document.getElementById("chat-input").addEventListener("keydown", function (e) {
            if (e.key === "Enter" && !e.shiftKey) {
                e.preventDefault();
                document.getElementById("chat-input-form").dispatchEvent(new Event("submit"));
            }
        });

        // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –±—É–¥—å-—è–∫—ñ —Å—Ç–∞—Ç—É—Å–∏ (—è–∫—â–æ —î) —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥–∏
        setTimeout(() => {
            const statusDiv = document.getElementById("status");
            if (statusDiv) {
                statusDiv.style.opacity = "0";
                setTimeout(() => (statusDiv.style.display = "none"), 300);
            }
        }, 4000);
    </script>
</body>
</html>
